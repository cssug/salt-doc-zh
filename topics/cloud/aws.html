<!DOCTYPE html>







<html>
    <head>
        <meta charset="utf-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Getting Started With AWS EC2</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="1Y-ojT3ndjxA9coB77iUDyXPWxeuQ3T4_r0j-QG6QHg" />

        
        <link rel="stylesheet" href="../../_static/css/core.min.css">
        <link rel="stylesheet" href="../../_static/css/webhelp.min_v1.4.4.css">
            <link rel="shortcut icon" href="../../_static/favicon.ico">

        <!--[if lt IE 9]>
        <script src="../../_static/js/respond.min.js"></script>
        <![endif]-->
        <link rel="top" title="" href="../../index.html">
        <link rel="up" title="Salt云端" href="index.html">
        <link rel="next" title="Getting Started With GoGrid" href="gogrid.html">
        <link rel="prev" title="Getting Started With DigitalOcean" href="digitalocean.html">
    </head>

    <body class="index">
        <!--[if lt IE 8]>
            <p>You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser.</a></p>
        <![endif]-->
        <div id="wrapper">
            <div id="page-content-wrapper">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-12 col-md-11 col-md-offset-1 col-lg-10 col-lg-offset-1">
                            <!--start navbar-->
                            <nav class="navbar navbar-default">
                                <div class="navbar-header">
                                    <button type="button" class="pull-left navbar-toggle collapsed" id="menu-toggle"><span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                    </button>
                                    <ul id="header-nav" class="nav navbar-nav">
        <li>
            <a href="../../contents.html" title="Table of Contents">Table of Contents</a>
            
        </li>
        <li>
            <a href="../../glossary.html" title="Glossary">Glossary</a>
            
        </li>
        <li>
            <a href="digitalocean.html" title="Getting Started With DigitalOcean">上一页</a>
            
        </li>
        <li>
            <a href="gogrid.html" title="Getting Started With GoGrid">下一页</a>
            
        </li>
        <li>
            <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
            
        </li>
        <li>
            <a href="../../genindex.html" title="总目录">索引</a>
            
        </li> 

                                        

                                        
                                    </ul>
                                </div>
                            </nav>
                            <!--end navbar-->

                            

                            

                            
                            <div class="body-content">
                                
  <div class="section" id="getting-started-with-aws-ec2">
<h1>Getting Started With AWS EC2<a class="headerlink" href="#getting-started-with-aws-ec2" title="永久链接至标题">¶</a></h1>
<p>Amazon EC2 is a very widely used public cloud platform and one of the core
platforms Salt Cloud has been built to support.</p>
<p>Previously, the suggested driver for AWS EC2 was the <code class="docutils literal"><span class="pre">aws</span></code> driver. This
has been deprecated in favor of the <code class="docutils literal"><span class="pre">ec2</span></code> driver. Configuration using the
old <code class="docutils literal"><span class="pre">aws</span></code> driver will still function, but that driver is no longer in
active development.</p>
<div class="section" id="dependencies">
<h2>依赖<a class="headerlink" href="#dependencies" title="永久链接至标题">¶</a></h2>
<p>This driver requires the Python <code class="docutils literal"><span class="pre">requests</span></code> library to be installed.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="永久链接至标题">¶</a></h2>
<p>The following example illustrates some of the options that can be set. These
parameters are discussed in more detail below.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># Note: This example is for /etc/salt/cloud.providers or any file in the</span>
<span class="c1"># /etc/salt/cloud.providers.d/ directory.</span>

<span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-public-ips</span><span class="p p-Indicator">:</span>
  <span class="c1"># Set up the location of the salt master</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">minion</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">master</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">saltmaster.example.com</span>

  <span class="c1"># Set up grains information, which will be common for all nodes</span>
  <span class="c1"># using this provider</span>
  <span class="l l-Scalar l-Scalar-Plain">grains</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">node_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">broker</span>
    <span class="l l-Scalar l-Scalar-Plain">release</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1.0.1</span>

  <span class="c1"># Specify whether to use public or private IP for deploy script.</span>
  <span class="c1">#</span>
  <span class="c1"># Valid options are:</span>
  <span class="c1">#     private_ips - The salt-cloud command is run inside the EC2</span>
  <span class="c1">#     public_ips - The salt-cloud command is run outside of EC2</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_interface</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">public_ips</span>

  <span class="c1"># Optionally configure the Windows credential validation number of</span>
  <span class="c1"># retries and delay between retries.  This defaults to 10 retries</span>
  <span class="c1"># with a one second delay betwee retries</span>
  <span class="l l-Scalar l-Scalar-Plain">win_deploy_auth_retries</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="l l-Scalar l-Scalar-Plain">win_deploy_auth_retry_delay</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

  <span class="c1"># Set the EC2 access credentials (see below)</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="s">&#39;use-instance-role-credentials&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="s">&#39;use-instance-role-credentials&#39;</span>

  <span class="c1"># Make sure this key is owned by root with permissions 0400.</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">private_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/salt/my_test_key.pem</span>
  <span class="l l-Scalar l-Scalar-Plain">keyname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_test_key</span>
  <span class="l l-Scalar l-Scalar-Plain">securitygroup</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>

  <span class="c1"># Optionally configure default region</span>
  <span class="c1"># Use salt-cloud --list-locations &lt;provider&gt; to obtain valid regions</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1</span>
  <span class="l l-Scalar l-Scalar-Plain">availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1b</span>

  <span class="c1"># Configure which user to use to run the deploy script. This setting is</span>
  <span class="c1"># dependent upon the AMI that is used to deploy. It is usually safer to</span>
  <span class="c1"># configure this individually in a profile, than globally. Typical users</span>
  <span class="c1"># are:</span>
  <span class="c1">#</span>
  <span class="c1"># Amazon Linux -&gt; ec2-user</span>
  <span class="c1"># RHEL         -&gt; ec2-user</span>
  <span class="c1"># CentOS       -&gt; ec2-user</span>
  <span class="c1"># Ubuntu       -&gt; ubuntu</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>

  <span class="c1"># Optionally add an IAM profile</span>
  <span class="l l-Scalar l-Scalar-Plain">iam_profile</span><span class="p p-Indicator">:</span> <span class="s">&#39;arn:aws:iam::123456789012:instance-profile/ExampleInstanceProfile&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>


<span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-private-ips</span><span class="p p-Indicator">:</span>
  <span class="c1"># Set up the location of the salt master</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">minion</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">master</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">saltmaster.example.com</span>

  <span class="c1"># Specify whether to use public or private IP for deploy script.</span>
  <span class="c1">#</span>
  <span class="c1"># Valid options are:</span>
  <span class="c1">#     private_ips - The salt-master is also hosted with EC2</span>
  <span class="c1">#     public_ips - The salt-master is hosted outside of EC2</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_interface</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">private_ips</span>

  <span class="c1"># Optionally configure the Windows credential validation number of</span>
  <span class="c1"># retries and delay between retries.  This defaults to 10 retries</span>
  <span class="c1"># with a one second delay betwee retries</span>
  <span class="l l-Scalar l-Scalar-Plain">win_deploy_auth_retries</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="l l-Scalar l-Scalar-Plain">win_deploy_auth_retry_delay</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

  <span class="c1"># Set the EC2 access credentials (see below)</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="s">&#39;use-instance-role-credentials&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="s">&#39;use-instance-role-credentials&#39;</span>

  <span class="c1"># Make sure this key is owned by root with permissions 0400.</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">private_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/salt/my_test_key.pem</span>
  <span class="l l-Scalar l-Scalar-Plain">keyname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_test_key</span>

  <span class="c1"># This one should NOT be specified if VPC was not configured in AWS to be</span>
  <span class="c1"># the default. It might cause an error message which says that network</span>
  <span class="c1"># interfaces and an instance-level security groups may not be specified</span>
  <span class="c1"># on the same request.</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">securitygroup</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>

  <span class="c1"># Optionally configure default region</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1</span>
  <span class="l l-Scalar l-Scalar-Plain">availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1b</span>

  <span class="c1"># Configure which user to use to run the deploy script. This setting is</span>
  <span class="c1"># dependent upon the AMI that is used to deploy. It is usually safer to</span>
  <span class="c1"># configure this individually in a profile, than globally. Typical users</span>
  <span class="c1"># are:</span>
  <span class="c1">#</span>
  <span class="c1"># Amazon Linux -&gt; ec2-user</span>
  <span class="c1"># RHEL         -&gt; ec2-user</span>
  <span class="c1"># CentOS       -&gt; ec2-user</span>
  <span class="c1"># Ubuntu       -&gt; ubuntu</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>

  <span class="c1"># Optionally add an IAM profile</span>
  <span class="l l-Scalar l-Scalar-Plain">iam_profile</span><span class="p p-Indicator">:</span> <span class="s">&#39;my</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">profile</span><span class="nv"> </span><span class="s">name&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<div class="versionchanged">
<p><span class="versionmodified">在 2015.8.0 版更改.</span></p>
</div>
<p class="last">The <code class="docutils literal"><span class="pre">provider</span></code> parameter in cloud provider definitions was renamed to <code class="docutils literal"><span class="pre">driver</span></code>. This
change was made to avoid confusion with the <code class="docutils literal"><span class="pre">provider</span></code> parameter that is used in cloud profile
definitions. Cloud provider definitions now use <code class="docutils literal"><span class="pre">driver</span></code> to refer to the Salt cloud module that
provides the underlying functionality to connect to a cloud host, while cloud profiles continue
to use <code class="docutils literal"><span class="pre">provider</span></code> to refer to provider configurations that you define.</p>
</div>
</div>
<div class="section" id="access-credentials">
<h2>Access Credentials<a class="headerlink" href="#access-credentials" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">id</span></code> and <code class="docutils literal"><span class="pre">key</span></code> settings may be found in the Security Credentials area
of the AWS Account page:</p>
<p><a class="reference external" href="https://portal.aws.amazon.com/gp/aws/securityCredentials">https://portal.aws.amazon.com/gp/aws/securityCredentials</a></p>
<p>Both are located in the Access Credentials area of the page, under the Access
Keys tab. The <code class="docutils literal"><span class="pre">id</span></code> setting is labeled Access Key ID, and the <code class="docutils literal"><span class="pre">key</span></code> setting
is labeled Secret Access Key.</p>
<p>Note: if either <code class="docutils literal"><span class="pre">id</span></code> or <code class="docutils literal"><span class="pre">key</span></code> is set to 'use-instance-role-credentials' it is
assumed that Salt is running on an AWS instance, and the instance role
credentials will be retrieved and used.  Since both the <code class="docutils literal"><span class="pre">id</span></code> and <code class="docutils literal"><span class="pre">key</span></code> are
required parameters for the AWS ec2 provider, it is recommended to set both
to 'use-instance-role-credentials' for this functionality.</p>
<p>A &quot;static&quot; and &quot;permanent&quot; Access Key ID and Secret Key can be specified,
but this is not recommended.  Instance role keys are rotated on a regular
basis, and are the recommended method of specifying AWS credentials.</p>
</div>
<div class="section" id="windows-deploy-timeouts">
<h2>Windows Deploy Timeouts<a class="headerlink" href="#windows-deploy-timeouts" title="永久链接至标题">¶</a></h2>
<p>For Windows instances, it may take longer than normal for the instance to be
ready.  In these circumstances, the provider configuration can be configured
with a <code class="docutils literal"><span class="pre">win_deploy_auth_retries</span></code> and/or a <code class="docutils literal"><span class="pre">win_deploy_auth_retry_delay</span></code>
setting, which default to 10 retries and a one second delay between retries.
These retries and timeouts relate to validating the Administrator password
once AWS provides the credentials via the AWS API.</p>
</div>
<div class="section" id="id1">
<h2>Windows Deploy Timeouts<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>For Windows instances, it may take longer than normal for the instance to be
ready.  In these circumstances, the provider configuration can be configured
with a <code class="docutils literal"><span class="pre">win_deploy_auth_retries</span></code> and/or a <code class="docutils literal"><span class="pre">win_deploy_auth_retry_delay</span></code>
setting, which default to 10 retries and a one second delay between retries.
These retries and timeouts relate to validating the Administrator password
once AWS provides the credentials via the AWS API.</p>
</div>
<div class="section" id="key-pairs">
<h2>Key Pairs<a class="headerlink" href="#key-pairs" title="永久链接至标题">¶</a></h2>
<p>In order to create an instance with Salt installed and configured, a key pair
will need to be created. This can be done in the EC2 Management Console, in the
Key Pairs area. These key pairs are unique to a specific region. Keys in the
us-east-1 region can be configured at:</p>
<p><a class="reference external" href="https://console.aws.amazon.com/ec2/home?region=us-east-1#s=KeyPairs">https://console.aws.amazon.com/ec2/home?region=us-east-1#s=KeyPairs</a></p>
<p>Keys in the us-west-1 region can be configured at</p>
<p><a class="reference external" href="https://console.aws.amazon.com/ec2/home?region=us-west-1#s=KeyPairs">https://console.aws.amazon.com/ec2/home?region=us-west-1#s=KeyPairs</a></p>
<p>...and so on. When creating a key pair, the browser will prompt to download a
pem file. This file must be placed in a directory accessible by Salt Cloud,
with permissions set to either 0400 or 0600.</p>
</div>
<div class="section" id="security-groups">
<h2>Security Groups<a class="headerlink" href="#security-groups" title="永久链接至标题">¶</a></h2>
<p>An instance on EC2 needs to belong to a security group. Like key pairs, these
are unique to a specific region. These are also configured in the EC2
Management Console. Security groups for the us-east-1 region can be configured
at:</p>
<p><a class="reference external" href="https://console.aws.amazon.com/ec2/home?region=us-east-1#s=SecurityGroups">https://console.aws.amazon.com/ec2/home?region=us-east-1#s=SecurityGroups</a></p>
<p>...and so on.</p>
<p>A security group defines firewall rules which an instance will adhere to. If
the salt-master is configured outside of EC2, the security group must open the
SSH port (usually port 22) in order for Salt Cloud to install Salt.</p>
</div>
<div class="section" id="iam-profile">
<h2>IAM Profile<a class="headerlink" href="#iam-profile" title="永久链接至标题">¶</a></h2>
<p>Amazon EC2 instances support the concept of an <a class="reference external" href="http://docs.aws.amazon.com/IAM/latest/UserGuide/instance-profiles.html">instance profile</a>, which
is a logical container for the IAM role. At the time that you launch an EC2
instance, you can associate the instance with an instance profile, which in
turn corresponds to the IAM role. Any software that runs on the EC2 instance
is able to access AWS using the permissions associated with the IAM role.</p>
<p>Scaffolding the profile is a 2-step configuration process:</p>
<ol class="arabic">
<li><p class="first">Configure an IAM Role from the <a class="reference external" href="https://console.aws.amazon.com/iam/home?#roles">IAM Management Console</a>.</p>
</li>
<li><p class="first">Attach this role to a new profile. It can be done with the <a class="reference external" href="http://docs.aws.amazon.com/cli/latest/index.html">AWS CLI</a>:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>&gt; aws iam create-instance-profile --instance-profile-name PROFILE_NAME
&gt; aws iam add-role-to-instance-profile --instance-profile-name PROFILE_NAME --role-name ROLE_NAME
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>Once the profile is created, you can use the <strong>PROFILE_NAME</strong> to configure
your cloud profiles.</p>
</div>
<div class="section" id="cloud-profiles">
<h2>Cloud Profiles<a class="headerlink" href="#cloud-profiles" title="永久链接至标题">¶</a></h2>
<p>Set up an initial profile at <code class="docutils literal"><span class="pre">/etc/salt/cloud.profiles</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">base_ec2_private</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-private-ips</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-e565ba8c</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">t2.micro</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>

<span class="l l-Scalar l-Scalar-Plain">base_ec2_public</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-public-ips</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-e565ba8c</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">t2.micro</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>

<span class="l l-Scalar l-Scalar-Plain">base_ec2_db</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-public-ips</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-e565ba8c</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.xlarge</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdf</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdg</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">io1</span><span class="p p-Indicator">,</span> <span class="nv">iops</span><span class="p p-Indicator">:</span> <span class="nv">1000</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdh</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">io1</span><span class="p p-Indicator">,</span> <span class="nv">iops</span><span class="p p-Indicator">:</span> <span class="nv">1000</span> <span class="p p-Indicator">}</span>
  <span class="c1"># optionally add tags to profile:</span>
  <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="s">&#39;Environment&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;production&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;Role&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;database&#39;</span><span class="p p-Indicator">}</span>
  <span class="c1"># force grains to sync after install</span>
  <span class="l l-Scalar l-Scalar-Plain">sync_after_install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">grains</span>

<span class="l l-Scalar l-Scalar-Plain">base_ec2_vpc</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ec2-southeast-public-ips</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-a73264ce</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.xlarge</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>
  <span class="l l-Scalar l-Scalar-Plain">script</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">/etc/salt/cloud.deploy.d/user_data.sh</span>
  <span class="l l-Scalar l-Scalar-Plain">network_interfaces</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceIndex</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="l l-Scalar l-Scalar-Plain">PrivateIpAddresses</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Primary</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="c1">#auto assign public ip (not EIP)</span>
      <span class="l l-Scalar l-Scalar-Plain">AssociatePublicIpAddress</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="l l-Scalar l-Scalar-Plain">SubnetId</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">subnet-813d4bbf</span>
      <span class="l l-Scalar l-Scalar-Plain">SecurityGroupId</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sg-750af413</span>
  <span class="l l-Scalar l-Scalar-Plain">del_root_vol_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
  <span class="l l-Scalar l-Scalar-Plain">del_all_vol_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdf</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdg</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">io1</span><span class="p p-Indicator">,</span> <span class="nv">iops</span><span class="p p-Indicator">:</span> <span class="nv">1000</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">size</span><span class="p p-Indicator">:</span> <span class="nv">10</span><span class="p p-Indicator">,</span> <span class="nv">device</span><span class="p p-Indicator">:</span> <span class="nv">/dev/sdh</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">io1</span><span class="p p-Indicator">,</span> <span class="nv">iops</span><span class="p p-Indicator">:</span> <span class="nv">1000</span> <span class="p p-Indicator">}</span>
  <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="s">&#39;Environment&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;production&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;Role&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;database&#39;</span><span class="p p-Indicator">}</span>
  <span class="l l-Scalar l-Scalar-Plain">sync_after_install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">grains</span>
</pre></div>
</div>
<p>The profile can now be realized with a salt command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># salt-cloud -p base_ec2 ami.example.com</span>
<span class="c1"># salt-cloud -p base_ec2_public ami.example.com</span>
<span class="c1"># salt-cloud -p base_ec2_private ami.example.com</span>
</pre></div>
</div>
<p>This will create an instance named <code class="docutils literal"><span class="pre">ami.example.com</span></code> in EC2. The minion that
is installed on this instance will have an <code class="docutils literal"><span class="pre">id</span></code> of <code class="docutils literal"><span class="pre">ami.example.com</span></code>. If
the command was executed on the salt-master, its Salt key will automatically be
signed on the master.</p>
<p>Once the instance has been created with salt-minion installed, connectivity to
it can be verified with Salt:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># salt &#39;ami.example.com&#39; test.ping</span>
</pre></div>
</div>
</div>
<div class="section" id="required-settings">
<h2>Required Settings<a class="headerlink" href="#required-settings" title="永久链接至标题">¶</a></h2>
<p>The following settings are always required for EC2:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># Set the EC2 login data</span>
<span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">HJGRYCILJLKJYG</span>
  <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="s">&#39;kdjgfsgm;woormgl/aserigjksjdhasdfgn&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">keyname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
  <span class="l l-Scalar l-Scalar-Plain">securitygroup</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">quick-start</span>
  <span class="l l-Scalar l-Scalar-Plain">private_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/root/test.pem</span>
  <span class="l l-Scalar l-Scalar-Plain">driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-settings">
<h2>Optional Settings<a class="headerlink" href="#optional-settings" title="永久链接至标题">¶</a></h2>
<p>EC2 allows a userdata file to be passed to the instance to be created. This
functionality was added to Salt in the 2015.5.0 release.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="c1"># Pass userdata to the instance to be created</span>
  <span class="l l-Scalar l-Scalar-Plain">userdata_file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/salt/my-userdata-file</span>
</pre></div>
</div>
<p>EC2 allows a location to be set for servers to be deployed in. Availability
zones exist inside regions, and may be added to increase specificity.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="c1"># Optionally configure default region</span>
  <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1</span>
  <span class="l l-Scalar l-Scalar-Plain">availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ap-southeast-1b</span>
</pre></div>
</div>
<p>EC2 instances can have a public or private IP, or both. When an instance is
deployed, Salt Cloud needs to log into it via SSH to run the deploy script.
By default, the public IP will be used for this. If the salt-cloud command is
run from another EC2 instance, the private IP should be used.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="c1"># Specify whether to use public or private IP for deploy script</span>
  <span class="c1"># private_ips or public_ips</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_interface</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">public_ips</span>
</pre></div>
</div>
<p>Many EC2 instances do not allow remote access to the root user by default.
Instead, another user must be used to run the deploy script using sudo. Some
common usernames include ec2-user (for Amazon Linux), ubuntu (for Ubuntu
instances), admin (official Debian) and bitnami (for images provided by
Bitnami).</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="c1"># Configure which user to use to run the deploy script</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>
</pre></div>
</div>
<p>Multiple usernames can be provided, in which case Salt Cloud will attempt to
guess the correct username. This is mostly useful in the main configuration
file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2-user</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bitnami</span>
</pre></div>
</div>
<p>Multiple security groups can also be specified in the same fashion:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">securitygroup</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">extra</span>
</pre></div>
</div>
<p>Your instances may optionally make use of EC2 Spot Instances. The
following example will request that spot instances be used and your
maximum bid will be $0.10. Keep in mind that different spot prices
may be needed based on the current value of the various EC2 instance
sizes. You can check current and past spot instance pricing via the
EC2 API or AWS Console.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">spot_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">spot_price</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.10</span>
</pre></div>
</div>
<p>By default, the spot instance type is set to 'one-time', meaning it will
be launched and, if it's ever terminated for whatever reason, it will not
be recreated. If you would like your spot instances to be relaunched after
a termination (by your or AWS), set the <code class="docutils literal"><span class="pre">type</span></code> to 'persistent'.</p>
<p>NOTE: Spot instances are a great way to save a bit of money, but you do
run the risk of losing your spot instances if the current price for the
instance size goes above your maximum bid.</p>
<p>The following parameters may be set in the cloud configuration file to
control various aspects of the spot instance launching:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">wait_for_spot_timeout</span></code>: seconds to wait before giving up on spot instance
launch (default=600)</li>
<li><code class="docutils literal"><span class="pre">wait_for_spot_interval</span></code>: seconds to wait in between polling requests to
determine if a spot instance is available (default=30)</li>
<li><code class="docutils literal"><span class="pre">wait_for_spot_interval_multiplier</span></code>: a multiplier to add to the interval in
between requests, which is useful if AWS is throttling your requests
(default=1)</li>
<li><code class="docutils literal"><span class="pre">wait_for_spot_max_failures</span></code>: maximum number of failures before giving up
on launching your spot instance (default=10)</li>
</ul>
<p>If you find that you're being throttled by AWS while polling for spot
instances, you can set the following in your core cloud configuration
file that will double the polling interval after each request to AWS.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">wait_for_spot_interval</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="l l-Scalar l-Scalar-Plain">wait_for_spot_interval_multiplier</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="http://aws.amazon.com/ec2/purchasing-options/spot-instances/">AWS Spot Instances</a> documentation for more information.</p>
<p>Block device mappings enable you to specify additional EBS volumes or instance
store volumes when the instance is launched. This setting is also available on
each cloud profile. Note that the number of instance stores varies by instance
type.  If more mappings are provided than are supported by the instance type,
mappings will be created in the order provided and additional mappings will be
ignored. Consult the <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html">AWS documentation</a> for a listing of the available
instance stores, and device names.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">block_device_mappings</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sdb</span>
      <span class="l l-Scalar l-Scalar-Plain">VirtualName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ephemeral0</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sdc</span>
      <span class="l l-Scalar l-Scalar-Plain">VirtualName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ephemeral1</span>
</pre></div>
</div>
<p>You can also use block device mappings to change the size of the root device at the
provisioning time. For example, assuming the root device is '/dev/sda', you can set
its size to 100G by using the following configuration.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">block_device_mappings</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sda</span>
      <span class="l l-Scalar l-Scalar-Plain">Ebs.VolumeSize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
      <span class="l l-Scalar l-Scalar-Plain">Ebs.VolumeType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
      <span class="l l-Scalar l-Scalar-Plain">Ebs.SnapshotId</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dummy0</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sdb</span>
      <span class="c1"># required for devices &gt; 2TB</span>
      <span class="l l-Scalar l-Scalar-Plain">Ebs.VolumeType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
      <span class="l l-Scalar l-Scalar-Plain">Ebs.VolumeSize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3001</span>
</pre></div>
</div>
<p>Existing EBS volumes may also be attached (not created) to your instances or
you can create new EBS volumes based on EBS snapshots. To simply attach an
existing volume use the <code class="docutils literal"><span class="pre">volume_id</span></code> parameter.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">device</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/xvdj</span>
<span class="l l-Scalar l-Scalar-Plain">volume_id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vol-12345abcd</span>
</pre></div>
</div>
<p>Or, to create a volume from an EBS snapshot, use the <code class="docutils literal"><span class="pre">snapshot</span></code> parameter.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">device</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/xvdj</span>
<span class="l l-Scalar l-Scalar-Plain">snapshot</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">snap-abcd12345</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">volume_id</span></code> will take precedence over the <code class="docutils literal"><span class="pre">snapshot</span></code> parameter.</p>
<p>Tags can be set once an instance has been launched.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">tag0</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
        <span class="l l-Scalar l-Scalar-Plain">tag1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-ec2-tags">
<h2>Modify EC2 Tags<a class="headerlink" href="#modify-ec2-tags" title="永久链接至标题">¶</a></h2>
<p>One of the features of EC2 is the ability to tag resources. In fact, under the
hood, the names given to EC2 instances by salt-cloud are actually just stored
as a tag called Name. Salt Cloud has the ability to manage these tags:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a get_tags mymachine
salt-cloud -a set_tags mymachine <span class="nv">tag1</span><span class="o">=</span>somestuff <span class="nv">tag2</span><span class="o">=</span><span class="s1">&#39;Other stuff&#39;</span>
salt-cloud -a del_tags mymachine tag1,tag2,tag3
</pre></div>
</div>
<p>It is possible to manage tags on any resource in EC2 with a Resource ID, not
just instances:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f get_tags my_ec2 <span class="nv">resource_id</span><span class="o">=</span>af5467ba
salt-cloud -f set_tags my_ec2 <span class="nv">resource_id</span><span class="o">=</span>af5467ba <span class="nv">tag1</span><span class="o">=</span>somestuff
salt-cloud -f del_tags my_ec2 <span class="nv">resource_id</span><span class="o">=</span>af5467ba tag1,tag2,tag3
</pre></div>
</div>
</div>
<div class="section" id="rename-ec2-instances">
<h2>Rename EC2 Instances<a class="headerlink" href="#rename-ec2-instances" title="永久链接至标题">¶</a></h2>
<p>As mentioned above, EC2 instances are named via a tag. However, renaming an
instance by renaming its tag will cause the salt keys to mismatch. A rename
function exists which renames both the instance, and the salt keys.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a rename mymachine <span class="nv">newname</span><span class="o">=</span>yourmachine
</pre></div>
</div>
</div>
<div class="section" id="rename-on-destroy">
<h2>Rename on Destroy<a class="headerlink" href="#rename-on-destroy" title="永久链接至标题">¶</a></h2>
<p>When instances on EC2 are destroyed, there will be a lag between the time that
the action is sent, and the time that Amazon cleans up the instance. During
this time, the instance still retails a Name tag, which will cause a collision
if the creation of an instance with the same name is attempted before the
cleanup occurs. In order to avoid such collisions, Salt Cloud can be configured
to rename instances when they are destroyed. The new name will look something
like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>myinstance-DEL20f5b8ad4eb64ed88f2c428df80a1a0c
</pre></div>
</div>
<p>In order to enable this, add rename_on_destroy line to the main
configuration file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rename_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-images">
<h2>Listing Images<a class="headerlink" href="#listing-images" title="永久链接至标题">¶</a></h2>
<p>Normally, images can be queried on a cloud provider by passing the
<code class="docutils literal"><span class="pre">--list-images</span></code> argument to Salt Cloud. This still holds true for EC2:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud --list-images my-ec2-config
</pre></div>
</div>
<p>However, the full list of images on EC2 is extremely large, and querying all of
the available images may cause Salt Cloud to behave as if frozen. Therefore,
the default behavior of this option may be modified, by adding an <code class="docutils literal"><span class="pre">owner</span></code>
argument to the provider configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">owner</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-marketplace</span>
</pre></div>
</div>
<p>The possible values for this setting are <code class="docutils literal"><span class="pre">amazon</span></code>, <code class="docutils literal"><span class="pre">aws-marketplace</span></code>,
<code class="docutils literal"><span class="pre">self</span></code>, <code class="docutils literal"><span class="pre">&lt;AWS</span> <span class="pre">account</span> <span class="pre">ID&gt;</span></code> or <code class="docutils literal"><span class="pre">all</span></code>. The default setting is <code class="docutils literal"><span class="pre">amazon</span></code>.
Take note that <code class="docutils literal"><span class="pre">all</span></code> and <code class="docutils literal"><span class="pre">aws-marketplace</span></code> may cause Salt Cloud to appear
as if it is freezing, as it tries to handle the large amount of data.</p>
<p>It is also possible to perform this query using different settings without
modifying the configuration files. To do this, call the <code class="docutils literal"><span class="pre">avail_images</span></code>
function directly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f avail_images my-ec2-config <span class="nv">owner</span><span class="o">=</span>aws-marketplace
</pre></div>
</div>
</div>
<div class="section" id="ec2-images">
<h2>EC2 Images<a class="headerlink" href="#ec2-images" title="永久链接至标题">¶</a></h2>
<p>The following are lists of available AMI images, generally sorted by OS. These
lists are on 3rd-party websites, are not managed by Salt Stack in any way. They
are provided here as a reference for those who are interested, and contain no
warranty (express or implied) from anyone affiliated with Salt Stack. Most of
them have never been used, much less tested, by the Salt Stack team.</p>
<ul class="simple">
<li><a class="reference external" href="https://wiki.archlinux.org/index.php/Arch_Linux_AMIs_for_Amazon_Web_Services">Arch Linux</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="http://www.daemonology.net/freebsd-on-ec2/">FreeBSD</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="https://fedoraproject.org/wiki/Cloud_images">Fedora</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="http://wiki.centos.org/Cloud/AWS">CentOS</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="http://cloud-images.ubuntu.com/locator/ec2/">Ubuntu</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="https://wiki.debian.org/Cloud/AmazonEC2Image">Debian</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="http://omnios.omniti.com/wiki.php/Installation#IntheCloud">OmniOS</a></li>
</ul>
<ul class="simple">
<li><a class="reference external" href="https://aws.amazon.com/marketplace">All Images on Amazon</a></li>
</ul>
</div>
<div class="section" id="show-image">
<h2>show_image<a class="headerlink" href="#show-image" title="永久链接至标题">¶</a></h2>
<p>This is a function that describes an AMI on EC2. This will give insight as to
the defaults that will be applied to an instance using a particular AMI.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ salt-cloud -f show_image ec2 <span class="nv">image</span><span class="o">=</span>ami-fd20ad94
</pre></div>
</div>
</div>
<div class="section" id="show-instance">
<h2>show_instance<a class="headerlink" href="#show-instance" title="永久链接至标题">¶</a></h2>
<p>This action is a thin wrapper around <code class="docutils literal"><span class="pre">--full-query</span></code>, which displays details on a
single instance only. In an environment with several machines, this will save a
user from having to sort through all instance data, just to examine a single
instance.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ salt-cloud -a show_instance myinstance
</pre></div>
</div>
</div>
<div class="section" id="ebs-optimized">
<h2>ebs_optimized<a class="headerlink" href="#ebs-optimized" title="永久链接至标题">¶</a></h2>
<p>This argument enables switching of the EbsOptimized setting which default
to 'false'. Indicates whether the instance is optimized for EBS I/O. This
optimization provides dedicated throughput to Amazon EBS and an optimized
configuration stack to provide optimal Amazon EBS I/O performance. This
optimization isn't available with all instance types. Additional usage
charges apply when using an EBS-optimized instance.</p>
<p>This setting can be added to the profile or map file for an instance.</p>
<p>If set to True, this setting will enable an instance to be EbsOptimized</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ebs_optimized</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>This can also be set as a cloud provider setting in the EC2 cloud
configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ebs_optimized</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="del-root-vol-on-destroy">
<h2>del_root_vol_on_destroy<a class="headerlink" href="#del-root-vol-on-destroy" title="永久链接至标题">¶</a></h2>
<p>This argument overrides the default DeleteOnTermination setting in the AMI for
the EBS root volumes for an instance. Many AMIs contain 'false' as a default,
resulting in orphaned volumes in the EC2 account, which may unknowingly be
charged to the account. This setting can be added to the profile or map file
for an instance.</p>
<p>If set, this setting will apply to the root EBS volume</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">del_root_vol_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>This can also be set as a cloud provider setting in the EC2 cloud
configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">del_root_vol_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="del-all-vols-on-destroy">
<h2>del_all_vols_on_destroy<a class="headerlink" href="#del-all-vols-on-destroy" title="永久链接至标题">¶</a></h2>
<p>This argument overrides the default DeleteOnTermination setting in the AMI for
the not-root EBS volumes for an instance. Many AMIs contain 'false' as a
default, resulting in orphaned volumes in the EC2 account, which may
unknowingly be charged to the account. This setting can be added to the profile
or map file for an instance.</p>
<p>If set, this setting will apply to any (non-root) volumes that were created
by salt-cloud using the 'volumes' setting.</p>
<p>The volumes will not be deleted under the following conditions
* If a volume is detached before terminating the instance
* If a volume is created without this setting and attached to the instance</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">del_all_vols_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>This can also be set as a cloud provider setting in the EC2 cloud
configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">del_all_vols_on_destroy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>The setting for this may be changed on all volumes of an existing instance
using one of the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a delvol_on_destroy myinstance
salt-cloud -a keepvol_on_destroy myinstance
salt-cloud -a show_delvol_on_destroy myinstance
</pre></div>
</div>
<p>The setting for this may be changed on a volume on an existing instance
using one of the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a delvol_on_destroy myinstance <span class="nv">device</span><span class="o">=</span>/dev/sda1
salt-cloud -a delvol_on_destroy myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-1a2b3c4d
salt-cloud -a keepvol_on_destroy myinstance <span class="nv">device</span><span class="o">=</span>/dev/sda1
salt-cloud -a keepvol_on_destroy myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-1a2b3c4d
salt-cloud -a show_delvol_on_destroy myinstance <span class="nv">device</span><span class="o">=</span>/dev/sda1
salt-cloud -a show_delvol_on_destroy myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-1a2b3c4d
</pre></div>
</div>
</div>
<div class="section" id="ec2-termination-protection">
<h2>EC2 Termination Protection<a class="headerlink" href="#ec2-termination-protection" title="永久链接至标题">¶</a></h2>
<p>EC2 allows the user to enable and disable termination protection on a specific
instance. An instance with this protection enabled cannot be destroyed. The EC2
driver adds a show_term_protect action to the regular EC2 functionality.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a show_term_protect mymachine
salt-cloud -a enable_term_protect mymachine
salt-cloud -a disable_term_protect mymachine
</pre></div>
</div>
</div>
<div class="section" id="alternate-endpoint">
<h2>Alternate Endpoint<a class="headerlink" href="#alternate-endpoint" title="永久链接至标题">¶</a></h2>
<p>Normally, EC2 endpoints are build using the region and the service_url. The
resulting endpoint would follow this pattern:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ec2.&lt;region&gt;.&lt;service_url&gt;
</pre></div>
</div>
<p>This results in an endpoint that looks like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ec2.us-east-1.amazonaws.com
</pre></div>
</div>
<p>There are other projects that support an EC2 compatibility layer, which this
scheme does not account for. This can be overridden by specifying the endpoint
directly in the main cloud configuration file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my-ec2-config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">endpoint</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">myendpoint.example.com:1138/services/Cloud</span>
</pre></div>
</div>
</div>
<div class="section" id="volume-management">
<h2>Volume Management<a class="headerlink" href="#volume-management" title="永久链接至标题">¶</a></h2>
<p>The EC2 driver has several functions and actions for management of EBS volumes.</p>
<div class="section" id="creating-volumes">
<h3>Creating Volumes<a class="headerlink" href="#creating-volumes" title="永久链接至标题">¶</a></h3>
<p>A volume may be created, independent of an instance. A zone must be specified.
A size or a snapshot may be specified (in GiB). If neither is given, a default
size of 10 GiB will be used. If a snapshot is given, the size of the snapshot
will be used.</p>
<p>The following parameters may also be set (when providing a snapshot OR size):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">type</span></code>: choose between standard (magnetic disk), gp2 (SSD), or io1 (provisioned IOPS).
(default=standard)</li>
<li><code class="docutils literal"><span class="pre">iops</span></code>: the number of IOPS (only applicable to io1 volumes) (default varies on volume size)</li>
<li><code class="docutils literal"><span class="pre">encrypted</span></code>: enable encryption on the volume (default=false)</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f create_volume ec2 <span class="nv">zone</span><span class="o">=</span>us-east-1b
salt-cloud -f create_volume ec2 <span class="nv">zone</span><span class="o">=</span>us-east-1b <span class="nv">size</span><span class="o">=</span>10
salt-cloud -f create_volume ec2 <span class="nv">zone</span><span class="o">=</span>us-east-1b <span class="nv">snapshot</span><span class="o">=</span>snap12345678
salt-cloud -f create_volume ec2 <span class="nv">size</span><span class="o">=</span><span class="m">10</span> <span class="nv">type</span><span class="o">=</span>standard
salt-cloud -f create_volume ec2 <span class="nv">size</span><span class="o">=</span><span class="m">10</span> <span class="nv">type</span><span class="o">=</span>gp2
salt-cloud -f create_volume ec2 <span class="nv">size</span><span class="o">=</span><span class="m">10</span> <span class="nv">type</span><span class="o">=</span>io1 <span class="nv">iops</span><span class="o">=</span>1000
</pre></div>
</div>
</div>
<div class="section" id="attaching-volumes">
<h3>Attaching Volumes<a class="headerlink" href="#attaching-volumes" title="永久链接至标题">¶</a></h3>
<p>Unattached volumes may be attached to an instance. The following values are
required; name or instance_id, volume_id, and device.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a attach_volume myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-12345 <span class="nv">device</span><span class="o">=</span>/dev/sdb1
</pre></div>
</div>
</div>
<div class="section" id="show-a-volume">
<h3>Show a Volume<a class="headerlink" href="#show-a-volume" title="永久链接至标题">¶</a></h3>
<p>The details about an existing volume may be retrieved.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a show_volume myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-12345
salt-cloud -f show_volume ec2 <span class="nv">volume_id</span><span class="o">=</span>vol-12345
</pre></div>
</div>
</div>
<div class="section" id="detaching-volumes">
<h3>Detaching Volumes<a class="headerlink" href="#detaching-volumes" title="永久链接至标题">¶</a></h3>
<p>An existing volume may be detached from an instance.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -a detach_volume myinstance <span class="nv">volume_id</span><span class="o">=</span>vol-12345
</pre></div>
</div>
</div>
<div class="section" id="deleting-volumes">
<h3>Deleting Volumes<a class="headerlink" href="#deleting-volumes" title="永久链接至标题">¶</a></h3>
<p>A volume that is not attached to an instance may be deleted.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f delete_volume ec2 <span class="nv">volume_id</span><span class="o">=</span>vol-12345
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-key-pairs">
<h2>Managing Key Pairs<a class="headerlink" href="#managing-key-pairs" title="永久链接至标题">¶</a></h2>
<p>The EC2 driver has the ability to manage key pairs.</p>
<div class="section" id="creating-a-key-pair">
<h3>Creating a Key Pair<a class="headerlink" href="#creating-a-key-pair" title="永久链接至标题">¶</a></h3>
<p>A key pair is required in order to create an instance. When creating a key pair
with this function, the return data will contain a copy of the private key.
This private key is not stored by Amazon, will not be obtainable past this
point, and should be stored immediately.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f create_keypair ec2 <span class="nv">keyname</span><span class="o">=</span>mykeypair
</pre></div>
</div>
</div>
<div class="section" id="importing-a-key-pair">
<h3>Importing a Key Pair<a class="headerlink" href="#importing-a-key-pair" title="永久链接至标题">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f import_keypair ec2 <span class="nv">keyname</span><span class="o">=</span>mykeypair <span class="nv">file</span><span class="o">=</span>/path/to/id_rsa.pub
</pre></div>
</div>
</div>
<div class="section" id="show-a-key-pair">
<h3>Show a Key Pair<a class="headerlink" href="#show-a-key-pair" title="永久链接至标题">¶</a></h3>
<p>This function will show the details related to a key pair, not including the
private key itself (which is not stored by Amazon).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f show_keypair ec2 <span class="nv">keyname</span><span class="o">=</span>mykeypair
</pre></div>
</div>
</div>
<div class="section" id="delete-a-key-pair">
<h3>Delete a Key Pair<a class="headerlink" href="#delete-a-key-pair" title="永久链接至标题">¶</a></h3>
<p>This function removes the key pair from Amazon.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>salt-cloud -f delete_keypair ec2 <span class="nv">keyname</span><span class="o">=</span>mykeypair
</pre></div>
</div>
</div>
</div>
<div class="section" id="launching-instances-into-a-vpc">
<h2>Launching instances into a VPC<a class="headerlink" href="#launching-instances-into-a-vpc" title="永久链接至标题">¶</a></h2>
<div class="section" id="simple-launching-into-a-vpc">
<h3>Simple launching into a VPC<a class="headerlink" href="#simple-launching-into-a-vpc" title="永久链接至标题">¶</a></h3>
<p>In the amazon web interface, identify the id of the subnet into which your
image should be created. Then, edit your cloud.profiles file like so:-</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">profile-id</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">provider-name</span>
  <span class="l l-Scalar l-Scalar-Plain">subnetid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">subnet-XXXXXXXX</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-XXXXXXXX</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
  <span class="l l-Scalar l-Scalar-Plain">securitygroupid</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sg-XXXXXXXX</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-interface-properties">
<h3>Specifying interface properties<a class="headerlink" href="#specifying-interface-properties" title="永久链接至标题">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">2014.7.0 新版功能.</span></p>
</div>
<p>Launching into a VPC allows you to specify more complex configurations for
the network interfaces of your virtual machines, for example:-</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">profile-id</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">provider-name</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ami-XXXXXXXX</span>
  <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh_username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>

  <span class="c1"># Do not include either &#39;subnetid&#39; or &#39;securitygroupid&#39; here if you are</span>
  <span class="c1"># going to manually specify interface configuration</span>
  <span class="c1">#</span>
  <span class="l l-Scalar l-Scalar-Plain">network_interfaces</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DeviceIndex</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="l l-Scalar l-Scalar-Plain">SubnetId</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">subnet-XXXXXXXX</span>
      <span class="l l-Scalar l-Scalar-Plain">SecurityGroupId</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sg-XXXXXXXX</span>

      <span class="c1"># Uncomment this line if you would like to set an explicit private</span>
      <span class="c1"># IP address for the ec2 instance</span>
      <span class="c1">#</span>
      <span class="c1"># PrivateIpAddress: 192.168.1.66</span>

      <span class="c1"># Uncomment this to associate an existing Elastic IP Address with</span>
      <span class="c1"># this network interface:</span>
      <span class="c1">#</span>
      <span class="c1"># associate_eip: eipalloc-XXXXXXXX</span>

      <span class="c1"># You can allocate more than one IP address to an interface. Use the</span>
      <span class="c1"># &#39;ip addr list&#39; command to see them.</span>
      <span class="c1">#</span>
      <span class="c1"># SecondaryPrivateIpAddressCount: 2</span>

      <span class="c1"># Uncomment this to allocate a new Elastic IP Address to this</span>
      <span class="c1"># interface (will be associated with the primary private ip address</span>
      <span class="c1"># of the interface</span>
      <span class="c1">#</span>
      <span class="c1"># allocate_new_eip: True</span>

      <span class="c1"># Uncomment this instead to allocate a new Elastic IP Address to</span>
      <span class="c1"># both the primary private ip address and each of the secondary ones</span>
      <span class="c1">#</span>
      <span class="l l-Scalar l-Scalar-Plain">allocate_new_eips</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

      <span class="c1"># Uncomment this if you&#39;re creating NAT instances. Allows an instance</span>
      <span class="c1"># to accept IP packets with destinations other than itself.</span>
      <span class="c1"># SourceDestCheck: False</span>
</pre></div>
</div>
<p>Note that it is an error to assign a 'subnetid' or 'securitygroupid' to a
profile where the interfaces are manually configured like this. These are both
really properties of each network interface, not of the machine itself.</p>
</div>
</div>
</div>


                            </div>
                            <a href="digitalocean.html"><button data-container="body" data-toggle="tooltip" data-placement="bottom" title="Getting Started With DigitalOcean" id="prev-button" type="button" class="btn btn-secondary"><span class="glyphicon glyphicon-chevron-left"></span> Previous</button></a>
                            <a href="gogrid.html"><button data-container="body" data-toggle="tooltip" data-placement="bottom" title="Getting Started With GoGrid" id="next-button" type="button" class="btn btn-primary">
                                Next <span class="glyphicon glyphicon-chevron-right"></span></button></a>
                        </div>
                    </div>
                    <div class="footer">
                        <hr />

                        
                    </div> <!--end footer-->

                    </div>
                </div>
            <!--start sidebar-->
            <div id="sidebar-wrapper">
            <div id="sidebar-static">

                <a class="ss-logo" href="http://saltstack.com"><img width="250" height="63" class="nolightbox sidebar-logo" src="../../_static/images/saltstack_logo.svg"></a>

                
                <div class="versions">
                    <p>Version 2016.3.0-172-gbf4b651</p>
                </div>
                

                <div id="search-form" class="inner-addon left-addon">
                    <i class="glyphicon glyphicon-search"></i>
                    <input type="text" class="form-control">
                </div>

            </div> <!--end sidebar-static-->

                <div id="sidebar-nav">
                    
                    
                    
                    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">SaltStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">安装教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuring Salt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_salt.html">Using Salt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/index.html">Remote Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../states/index.html">Configuration Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event/index.html">Events &amp; Reactor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestrate/index.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/index.html">Salt SSH</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Salt云端</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-started">入门指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-salt-cloud">Using Salt Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#core-configuration">Cloud核心配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#windows-configuration">Windows Configuration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#cloud-provider-specifics">Cloud Provider Specifics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aliyun.html">    Getting Started With Aliyun</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html">    Getting Started With Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="digitalocean.html">    Getting Started With DigitalOcean</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">    Getting Started With EC2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">依赖</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-credentials">Access Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#windows-deploy-timeouts">Windows Deploy Timeouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Windows Deploy Timeouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-pairs">Key Pairs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security-groups">Security Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iam-profile">IAM Profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cloud-profiles">Cloud Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#required-settings">Required Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-settings">Optional Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-ec2-tags">Modify EC2 Tags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rename-ec2-instances">Rename EC2 Instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rename-on-destroy">Rename on Destroy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listing-images">Listing Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ec2-images">EC2 Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-image">show_image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-instance">show_instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ebs-optimized">ebs_optimized</a></li>
<li class="toctree-l4"><a class="reference internal" href="#del-root-vol-on-destroy">del_root_vol_on_destroy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#del-all-vols-on-destroy">del_all_vols_on_destroy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ec2-termination-protection">EC2 Termination Protection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternate-endpoint">Alternate Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#volume-management">Volume Management</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#creating-volumes">Creating Volumes</a></li>
<li class="toctree-l5"><a class="reference internal" href="#attaching-volumes">Attaching Volumes</a></li>
<li class="toctree-l5"><a class="reference internal" href="#show-a-volume">Show a Volume</a></li>
<li class="toctree-l5"><a class="reference internal" href="#detaching-volumes">Detaching Volumes</a></li>
<li class="toctree-l5"><a class="reference internal" href="#deleting-volumes">Deleting Volumes</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#managing-key-pairs">Managing Key Pairs</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#creating-a-key-pair">Creating a Key Pair</a></li>
<li class="toctree-l5"><a class="reference internal" href="#importing-a-key-pair">Importing a Key Pair</a></li>
<li class="toctree-l5"><a class="reference internal" href="#show-a-key-pair">Show a Key Pair</a></li>
<li class="toctree-l5"><a class="reference internal" href="#delete-a-key-pair">Delete a Key Pair</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#launching-instances-into-a-vpc">Launching instances into a VPC</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#simple-launching-into-a-vpc">Simple launching into a VPC</a></li>
<li class="toctree-l5"><a class="reference internal" href="#specifying-interface-properties">Specifying interface properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gogrid.html">    Getting Started With GoGrid</a></li>
<li class="toctree-l3"><a class="reference internal" href="gce.html">    Getting Started With Google Compute Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="hpcloud.html">    Getting Started With HP Cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="joyent.html">    Getting Started With Joyent</a></li>
<li class="toctree-l3"><a class="reference internal" href="lxc.html">    Getting Started With LXC</a></li>
<li class="toctree-l3"><a class="reference internal" href="linode.html">    Getting Started With Linode</a></li>
<li class="toctree-l3"><a class="reference internal" href="opennebula.html">    Getting Started With OpenNebula</a></li>
<li class="toctree-l3"><a class="reference internal" href="openstack.html">    Getting Started With OpenStack</a></li>
<li class="toctree-l3"><a class="reference internal" href="parallels.html">    Getting Started With Parallels</a></li>
<li class="toctree-l3"><a class="reference internal" href="profitbricks.html">    Getting Started With Profitbricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="proxmox.html">    Getting Started With Proxmox</a></li>
<li class="toctree-l3"><a class="reference internal" href="rackspace.html">    Getting Started With Rackspace</a></li>
<li class="toctree-l3"><a class="reference internal" href="saltify.html">    Getting Started With Saltify</a></li>
<li class="toctree-l3"><a class="reference internal" href="scaleway.html">    Getting Started With Scaleway</a></li>
<li class="toctree-l3"><a class="reference internal" href="softlayer.html">    Getting Started With SoftLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="vexxhost.html">    Getting Started With Vexxhost</a></li>
<li class="toctree-l3"><a class="reference internal" href="virtualbox.html">    Getting Started With Virtualbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="vmware.html">    Getting Started With VMware</a></li>
<li class="toctree-l3"><a class="reference internal" href="vsphere.html">    Getting Started With vSphere</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous-options">Miscellaneous Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#troubleshooting-steps">Troubleshooting Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extending-salt-cloud">Extending Salt Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-salt-cloud-from-salt">Using Salt Cloud from Salt</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#feature-comparison">Feature Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tutorials">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../proxyminion/index.html">Salt Proxy Minion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Salt Virt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref/cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref/index.html">Salt Module Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Salt开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
</ul>

                    
                    
                </div>

                <div id="sidebar-static-bottom">
                <div class="text-nowrap">
                    <!--social icons from http://vervex.deviantart.com/art/somacro-45-300dpi-social-media-icons-267955425-->
                    <ul id="social-links" class="list-inline">
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="watch saltstack videos on youtube" href="https://www.youtube.com/user/saltstack" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/youtube-variation.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="view the latest saltstack tweets" href="http://twitter.com/saltstackinc" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/twitter.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="subscribe to the salt users mailing list" href="https://groups.google.com/forum/#!forum/salt-users" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/email.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="download saltstack code from github" href="https://github.com/saltstack/salt" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/github.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="chat in #salt on freenode irc" href="http://webchat.freenode.net/?channels=salt&uio=mj10cnvljjk9dhj1zsyxmd10cnvl83" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/messenger-generic.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="/r/saltstack" href="http://www.reddit.com/r/saltstack/" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/reddit.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="ask a saltstack question on stackoverflow" href="http://stackoverflow.com/questions/tagged/salt-stack" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/stackoverflow.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="join or start a saltstack meetup" href="http://www.meetup.com/find/?keywords=saltstack" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/meetup.png" ></a></li>
                        <li><a data-container="body" data-delay='{ "show": 500, "hide": 100 }' data-toggle="tooltip" data-placement="top" title="follow saltstack on linkedin" href="http://www.linkedin.com/company/salt-stack-inc" target="_blank"><img class="nolightbox" width="24" src="../../_static/images/linkedin.png" ></a></li>
                    </ul>
                </div>
                </div>
            </div>
            <!--end sidebar-->

            </div> <!--end wrapper--> <!--end block content-->
        
    <script>
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '2015.8.7',
            SEARCH_CX:   '004624818632696854117:yfmprrbw3pk',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  'true'
        };
    </script>

    <script src="../../_static/js/core.min.js"></script>

    <script src="../../_static/js/webhelp.min_v1.4.3.js"></script>

        
    </body>
</html>